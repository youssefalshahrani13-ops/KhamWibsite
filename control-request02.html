<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø¨Ø§Ø± | Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª </title>
    <link rel="stylesheet" href="index-02-style.css">
    <link rel="stylesheet" href="control-request-02-style.css">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‡ÙˆÙØ± Ø¹Ù„Ù‰ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ */
        .editable-text { 
            cursor: pointer; 
            transition: 0.3s ease; 
            display: inline-block; 
            padding: 2px 5px;
            border-radius: 4px;
        }
        .editable-text:hover { 
            color: #7e7e7e !important; 
            background: rgba(255, 255, 255, 0.1);
        }
        
        .client-info-stack { display: flex; flex-direction: column; gap: 4px; }
        .unified-font-style { font-size: 13px !important; font-weight: 400 !important; opacity: 0.8; }

        .filter-container { display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 25px; }
        .filter-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 150px;
        }
        .filter-card:hover { background: rgba(255, 255, 255, 0.2); transform: translateY(-3px); }
        .filter-card.active { border-color: #fff; background: rgba(255, 255, 255, 0.3); }
        .badge-num { font-size: 20px; font-weight: 700; }
        #clearFilter { background: #ff4d4d; color: white; border: none; padding: 5px 15px; border-radius: 8px; cursor: pointer; display: none; }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        .action-group { display: flex; gap: 8px; align-items: center; justify-content: center; }
        .btn-contact {
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            color: white;
            text-decoration: none;
            transition: 0.3s;
        }
        .btn-whatsapp { background-color: #25D366; }
        .btn-email { background-color: #EA4335; }
        .btn-contact:hover { transform: scale(1.1); opacity: 0.9; }

        /* =========================================
           ØªÙ†Ø³ÙŠÙ‚ Ù…Ø³Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ (Breadcrumbs)
           ========================================= */
        .breadcrumb-container {
            width: 100%;
            max-width: 1100px;
            margin: 100px auto -100px; 
            padding: 0 20px;
            display: flex;
            justify-content: flex-start;
        }
        .breadcrumbs {
            list-style: none;
            display: flex;
            gap: 10px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
        }
        .breadcrumbs li { display: flex; align-items: center; }
        .breadcrumbs li a { color: white; text-decoration: none; transition: 0.3s; opacity: 0.8; }
        .breadcrumbs li a:hover { opacity: 1; text-decoration: underline; }
        .breadcrumbs li::after {
            content: ">";
            margin-right: 10px;
            font-size: 12px;
            opacity: 0.5;
        }
        .breadcrumbs li:last-child::after { display: none; }
        .breadcrumbs li:last-child { font-weight: 700; color: #ffffff; }
    </style>
</head>

<body>

<nav class="navbar"> 
    <div class="nav-container"> 
        <div class="logo"> 
            <a href="index.html">Ø­Ø¨Ø§Ø±</a> 
        </div>

        <ul class="nav-links" id="navLinksList"> 
            <li><a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li> 
            <li><a href="Request02.html">Ø·Ù„Ø¨ ØªØ¹Ø§ÙˆÙ†</a></li>
            <li><a href="chat02.html">Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</a></li> 
        </ul>

        <div class="auth-buttons" id="authSection">
            </div>
        
        <div class="menu-toggle" id="mobile-menu">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </div>
    </div>
</nav>


<div class="breadcrumb-container">
    <ul class="breadcrumbs">
        <li><a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
        <li><a href="control02.html">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a></li>
        <li>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</li>
    </ul>
</div>

<div class="main-hero admin-section">
    <div class="admin-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
            <button id="clearFilter" onclick="setFilter('all')">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙƒÙ„ âœ•</button>
        </div>

        <div class="filter-container">
            <div class="filter-card" onclick="setFilter('Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©')" id="card-pending">
                <span class="badge-num" id="num-pending" style="color: #ffcc00;">0</span>
                <span class="badge-label">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
            </div>
            <div class="filter-card" onclick="setFilter('Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°')" id="card-process">
                <span class="badge-num" id="num-process" style="color: #007bff;">0</span>
                <span class="badge-label">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</span>
            </div>
            <div class="filter-card" onclick="setFilter('ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°')" id="card-done">
                <span class="badge-num" id="num-done" style="color: #28a745;">0</span>
                <span class="badge-label">ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°</span>
            </div>
        </div>
        
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                        <th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th> 
                        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="requestsTable"></tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script> 
<script>
    const firebaseConfig = {
        apiKey: "AIzaSyC5LqK5nYvhmgVLB8utjPjLQdNQMy_qe2c",
        authDomain: "comments-test01.firebaseapp.com",
        databaseURL: "https://comments-test01-default-rtdb.firebaseio.com/",
        projectId: "comments-test01",
        storageBucket: "comments-test01.firebasestorage.app",
        messagingSenderId: "1061900134848",
        appId: "1:1061900134848:web:a740fa25f3a27a36be0025"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    
    let currentFilter = 'all';

    window.editField = function(key, fieldName, currentVal) {
        let newVal = prompt(`ØªØ¹Ø¯ÙŠÙ„ ${fieldName}:`, currentVal);
        if (newVal !== null && newVal.trim() !== "") {
            let updateData = {};
            const map = { "Ø§Ù„Ø§Ø³Ù…": "name", "Ø§Ù„Ù…Ø¬Ø§Ù„": "field", "Ø§Ù„Ø¬Ù‡Ø©": "represent", "Ø§Ù„Ø®Ø¯Ù…Ø©": "service", "Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©": "budget", "Ø§Ù„Ø¬ÙˆØ§Ù„": "contact" };
            updateData[map[fieldName]] = newVal;
            database.ref('collaboration_requests/' + key).update(updateData);
        }
    };

    window.setFilter = function(status) {
        currentFilter = status;
        document.getElementById('clearFilter').style.display = (status === 'all') ? 'none' : 'block';
        loadData();
    };

    function loadData() {
        database.ref('collaboration_requests').on('value', (snapshot) => {
            const tableBody = document.getElementById('requestsTable');
            tableBody.innerHTML = "";
            const data = snapshot.val();
            let counts = { "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©": 0, "Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°": 0, "ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°": 0 };

            if (!data) return;

            Object.keys(data).reverse().forEach((key) => {
                const req = data[key];
                const status = req.status || "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©";
                if(counts[status] !== undefined) counts[status]++;
                if (currentFilter !== 'all' && status !== currentFilter) return;

                let statusColor = (status === "ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°") ? "#28a745" : (status === "Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°" ? "#007bff" : "#ffcc00");

                // Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„
                const whatsappLink = req.contact ? `https://wa.me/${req.contact.replace(/\s+/g, '')}` : '#';
                const emailLink = req.email ? `mailto:${req.email}` : '#';

                tableBody.innerHTML += `
                    <tr>
                        <td>
                            <div class="client-info-stack">
                                <strong class="editable-text" onclick="editField('${key}', 'Ø§Ù„Ø§Ø³Ù…', '${req.name}')">${req.name}</strong>
                                <span class="unified-font-style editable-text" onclick="editField('${key}', 'Ø§Ù„Ø¬Ù‡Ø©', '${req.represent}')">${req.represent}</span>
                                <span class="unified-font-style editable-text" onclick="editField('${key}', 'Ø§Ù„Ø¬ÙˆØ§Ù„', '${req.contact}')" style="direction:ltr">${req.contact}</span>
                            </div>
                        </td>
                        <td>
                            <div class="client-info-stack">
                                <span class="editable-text" onclick="editField('${key}', 'Ø§Ù„Ø®Ø¯Ù…Ø©', '${req.service}')">Ø§Ù„Ø®Ø¯Ù…Ø©: ${req.service}</span>
                                <span class="unified-font-style editable-text" onclick="editField('${key}', 'Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©', '${req.budget}')">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©: ${req.budget}</span>
                                <span class="unified-font-style editable-text" onclick="editField('${key}', 'Ø§Ù„Ù…Ø¬Ø§Ù„', '${req.field || ''}')">Ø§Ù„Ù…Ø¬Ø§Ù„: ${req.field || 'Ø§Ø¶ØºØ· Ù„Ù„Ø¥Ø¶Ø§ÙØ©'}</span>
                            </div>
                        </td>
                        <td>
                            <button onclick="changeStatus('${key}', '${status}')" class="btn-action" style="background:${statusColor}; color:white; border:none; width:100px;">${status}</button>
                        </td>
                        <td>
                            <div class="action-group">
                                <a href="${whatsappLink}" target="_blank" class="btn-contact btn-whatsapp" title="ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨">
                                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.335-1.662c1.72.937 3.659 1.432 5.631 1.433h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                                </a>

                                ${req.email ? `
                                <a href="${emailLink}" class="btn-contact btn-email" title="Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
                                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
                                </a>` : ''}

                                <button class="btn-action delete-btn" onclick="deleteRequest('${key}')">Ø­Ø°Ù</button>
                            </div>
                        </td>
                    </tr>`;
            });
            updateCounterUI(counts);
        });
    }

    function updateCounterUI(counts) {
        document.getElementById('num-pending').innerText = counts["Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©"];
        document.getElementById('num-process').innerText = counts["Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°"];
        document.getElementById('num-done').innerText = counts["ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°"];
    }

    window.changeStatus = function(key, currentStatus) {
        let next = (currentStatus === "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©") ? "Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°" : (currentStatus === "Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°" ? "ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°" : "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©");
        database.ref('collaboration_requests/' + key).update({ status: next });
    };

    window.deleteRequest = function(key) {
        if(confirm("Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) database.ref('collaboration_requests/' + key).remove();
    };

    loadData();

    document.addEventListener("DOMContentLoaded", function() {
        const userName = localStorage.getItem("userName");
        const authSection = document.getElementById("authSection");

        if (userName && authSection) {
            authSection.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px;">
                    <a href="customer-profile02.html" 
                       style="color: #042de2; font-weight: 700; text-decoration: none; border: 2px solid #042de2; padding: 10px 24px; border-radius: 8px; transition: 0.3s ease; display: inline-flex; align-items: center; justify-content: center; font-size: 14px; min-width: 140px; box-sizing: border-box; background-color: #fff;"
                       onmouseover="this.style.color='#7e7e7e'; this.style.borderColor='#7e7e7e';" 
                       onmouseout="this.style.color='#042de2'; this.style.borderColor='#042de2';">
                         ${userName} ğŸ‘¤
                    </a>
                    <button onclick="logout()" 
                            style="background-color: #ff4d4d; border: 2px solid #ff4d4d; color: white; font-weight: 700; padding: 10px 24px; border-radius: 8px; cursor: pointer; font-family: inherit; transition: 0.3s ease; display: inline-flex; align-items: center; justify-content: center; font-size: 14px; min-width: 140px; box-sizing: border-box;"
                            onmouseover="this.style.backgroundColor='transparent'; this.style.color='#ff4d4d';" 
                            onmouseout="this.style.backgroundColor='#ff4d4d'; this.style.color='white';">
                        ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
                    </button>
                </div>
            `;
        }
    });

    window.logout = function() { 
        localStorage.removeItem("userName"); 
        location.reload(); 
    }









    document.addEventListener("DOMContentLoaded", function() {
    // ... Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹ (Ø¬Ù„Ø¨ Ø§Ù„Ø§Ø³Ù…ØŒ Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¥Ù„Ø®) ...

    const menuToggle = document.querySelector('#mobile-menu');
    const navLinks = document.querySelector('.nav-links');

    if (menuToggle) {
        menuToggle.addEventListener('click', () => {
            navLinks.classList.toggle('active');
            
            // Ø§Ø®ØªÙŠØ§Ø±ÙŠ: ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ø±Ø¬Ø± Ø¥Ù„Ù‰ X Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·
            menuToggle.classList.toggle('is-active'); 
        });
    }
});
</script>
</body>
</html>