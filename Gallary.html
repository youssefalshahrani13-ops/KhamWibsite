<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حبّار | معرض الصور التفاعلي</title>
    <link rel="stylesheet" href="Habbar01.css">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #042de2; color: white; font-family: 'IBM Plex Sans Arabic', sans-serif; }
        .gallery-container { padding: 40px 20px; max-width: 1200px; margin: auto; text-align: center; }
        
        .grid-container { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 20px; 
            margin-top: 30px;
        }

        /* كرت الصورة في الشبكة */
        .image-card { 
            background: white; 
            border-radius: 15px; 
            overflow: hidden; 
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            height: 250px;
        }
        .image-card:hover { transform: scale(1.03); box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .image-card img { width: 100%; height: 100%; object-fit: cover; }

        /* نافذة التكبير (Modal) */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.9);
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
        }
        .modal-content {
            background: #fff;
            margin: 20px auto;
            max-width: 700px;
            border-radius: 20px;
            overflow: hidden;
            color: #333;
            position: relative;
            animation: zoomIn 0.3s ease;
        }
        @keyframes zoomIn { from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;} }

        .modal-img { width: 100%; max-height: 500px; object-fit: contain; background: #eee; }
        .close-modal { position: absolute; top: 15px; left: 15px; font-size: 30px; cursor: pointer; color: white; z-index: 1001; }

        /* تنسيق التعليقات داخل المودال (نفس Habbar01) */
        .modal-details { padding: 20px; text-align: right; }
        .modal-actions { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .like-btn-large { background: #fff0f0; color: #e74c3c; border: none; padding: 10px 20px; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 18px; }

        .comments-section { border-top: 1px solid #eee; padding-top: 20px; }
        .comment-item { background: #f9f9f9; padding: 10px; border-radius: 10px; margin-bottom: 10px; border-right: 4px solid #042de2; }
        
        /* فورم إضافة تعليق (نفس ستايل مراجعات Habbar01) */
        .add-comment-form { margin-top: 20px; display: none; }
        .add-comment-form.show { display: block; }
        .add-comment-form textarea { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #ddd; margin-bottom: 10px; font-family: inherit; }
        .add-comment-form input { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #ddd; margin-bottom: 10px; }
        .btn-publish { background: #042de2; color: white; border: none; padding: 10px 25px; border-radius: 10px; cursor: pointer; font-weight: bold; }
        
        .toggle-comment-btn { color: #042de2; cursor: pointer; font-weight: bold; text-decoration: underline; margin-bottom: 10px; display: inline-block; }
    </style>
</head>
<body>

<nav class="navbar">
    <div class="nav-container">
        <div class="logo">
            <a href="index.html" id="adminLink">حبار</a>
        </div>
        
        <div class="menu-toggle" id="mobile-menu">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </div>

        <ul class="nav-links">
            <li><a href="index.html">الرئيسية</a></li>
            <li><a href="Habbar01.html">المحتوى</a></li>
            <li><a href="Request.html">طلب تعاون</a></li>
                        <li><a href="Gallary.html"> المنشورات</a></li>

            <li><a href="javascript:void(0)" onclick="goToAdmin()">الإدارة </a></li>
        </ul>
    </div>
</nav>


<div class="gallery-container">
    <h2 style="font-size: 32px; margin-bottom: 10px;">معرض المنشورات</h2>
    <p style="opacity: 0.8;">اضغط على أي صورة للتفاعل معها وإضافة تعليقك</p>

    <div class="grid-container" id="galleryGrid">
        </div>
</div>

<div id="imageModal" class="modal">
    <span class="close-modal" onclick="closeModal()">&times;</span>
    <div class="modal-content" id="modalContent">
        </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, push, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyC5LqK5nYvhmgVLB8utjPjLQdNQMy_qe2c",
        authDomain: "comments-test01.firebaseapp.com",
        databaseURL: "https://comments-test01-default-rtdb.firebaseio.com",
        projectId: "comments-test01",
        storageBucket: "comments-test01.firebasestorage.app",
        messagingSenderId: "1061900134848",
        appId: "1:1061900134848:web:a740fa25f3a27a36be0025"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const galleryRef = ref(db, 'interactive_gallery');

    // جلب الصور وعرضها في الشبكة
    onValue(galleryRef, (snapshot) => {
        const grid = document.getElementById('galleryGrid');
        grid.innerHTML = "";
        const data = snapshot.val();
        if (data) {
            Object.keys(data).reverse().forEach(id => {
                const post = data[id];
                grid.innerHTML += `
                    <div class="image-card" onclick="openImage('${id}')">
                        <img src="${post.url}" alt="حبار">
                    </div>
                `;
            });
        }
    });

    // دالة فتح الصورة (Global لتحويلها لـ window)
    window.openImage = (id) => {
        onValue(ref(db, `interactive_gallery/${id}`), (snapshot) => {
            const post = snapshot.val();
            if (!post) return;

            const modal = document.getElementById('imageModal');
            const content = document.getElementById('modalContent');
            
            const commentsHtml = post.comments ? Object.values(post.comments).reverse().map(c => `
                <div class="comment-item">
                    <div style="font-weight:bold; font-size:14px; color:#042de2;">${c.name}</div>
                    <div style="font-size:15px; margin-top:5px;">${c.text}</div>
                </div>
            `).join('') : '<p style="color:#999;">لا توجد تعليقات بعد.. كن أول المعلقين!</p>';

            content.innerHTML = `
                <img src="${post.url}" class="modal-img">
                <div class="modal-details">
                    <div class="modal-actions">
                        <button class="like-btn-large" onclick="handleLike('${id}', ${post.likes || 0})">❤️ ${post.likes || 0}</button>
                        <span style="color:#999; font-size:13px;">نُشر في: ${new Date(post.timestamp).toLocaleDateString('ar-SA')}</span>
                    </div>

                    <div class="comments-section">
                        <h4 style="margin-bottom:15px;">التعليقات</h4>
                        <span class="toggle-comment-btn" onclick="document.getElementById('commentForm').classList.toggle('show')">+ إضافة تعليق</span>
                        
                        <div id="commentForm" class="add-comment-form">
                            <input type="text" id="userName" placeholder="الاسم">
                            <textarea id="userComment" placeholder="اكتب تعليقك هنا..." rows="3"></textarea>
                            <button class="btn-publish" onclick="submitComment('${id}')">نشر التعليق</button>
                        </div>

                        <div style="margin-top:20px;">${commentsHtml}</div>
                    </div>
                </div>
            `;
            modal.style.display = "block";
            document.body.style.overflow = "hidden"; // منع السكرول خلف المودال
        });
    };

    window.closeModal = () => {
        document.getElementById('imageModal').style.display = "none";
        document.body.style.overflow = "auto";
    };

    window.handleLike = (id, currentLikes) => {
        update(ref(db, `interactive_gallery/${id}`), { likes: currentLikes + 1 });
    };

    window.submitComment = (id) => {
        const name = document.getElementById('userName').value;
        const text = document.getElementById('userComment').value;
        if (name && text) {
            push(ref(db, `interactive_gallery/${id}/comments`), {
                name: name,
                text: text,
                timestamp: Date.now()
            });
            document.getElementById('userName').value = "";
            document.getElementById('userComment').value = "";
        } else {
            alert("يرجى كتابة الاسم والتعليق");
        }
    };
</script>

<script>
    // إغلاق المودال عند الضغط خارجه
    window.onclick = function(event) {
        const modal = document.getElementById('imageModal');
        if (event.target == modal) closeModal();
    }

    // منطق الإدارة (كلمة السر)
    window.goToAdmin = function() {
        const password = prompt("منطقة خاصة، أدخل الرمز:");
        if (password === "jameel") {
            window.location.href = "Admin.html";
        } else if (password !== null) {
            alert("الرمز خاطئ!");
        }
    }
</script>

</body>

</html>
